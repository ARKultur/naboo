"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Vendor
const command_1 = require("@oclif/command");
const errors_1 = require("@oclif/errors");
const chalk_1 = require("chalk");
const cli_ux_1 = require("cli-ux");
// Services
const config_1 = require("./services/config");
const project_fetcher_1 = require("./services/project-fetcher");
const sleep = async (ms) => new Promise((resolve) => setTimeout(resolve, ms));
class default_1 extends command_1.default {
    constructor() {
        super(...arguments);
        this.projectConfig = new config_1.default();
    }
    async init() {
        const config = this.projectConfig.config;
        if (!config.apiUrl)
            errors_1.error('You must set an API url in your config');
        if (!config.apiKey)
            errors_1.error('You must set an API key in your config');
        // Fetch project from the GraphQL API.
        cli_ux_1.default.action.start(chalk_1.default.white('Fetch config'));
        await sleep(1000);
        const fetcher = new project_fetcher_1.default();
        this.project = await fetcher.fetch(config);
        if (!this.project)
            errors_1.error('Unable to fetch project');
        cli_ux_1.default.action.stop(chalk_1.default.green('âœ“'));
        console.log('');
    }
    async refreshProject() {
        const config = this.projectConfig.config;
        const fetcher = new project_fetcher_1.default();
        this.project = await fetcher.fetch(config);
    }
}
exports.default = default_1;
